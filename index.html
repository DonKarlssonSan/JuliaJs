<!DOCTYPE html>

<html>
<h1>Click to zoom</h1>
Re:
<input type="text" id="re" value="-0.835" />
Im:
<input type="text" id="im" value="-0.2321"/>
<button id="redrawButton">Redraw</button>
<div id="presetButtons"></div>
<canvas id="canvas" width="640" height="480" style="display: flex;">
</canvas>
<script>
(function() {
    var presets = [ { 
        name: "z^2 + (-0.70176-0.3842i)",
        re: -0.70176,
        im: -0.3842,
        fz: "z2" 
      } , {
        name: "z^2 + (-0.8+0.156i)",
        re: -0.8,
        im: 0.156,
        fz: "z2" 
      } , {
        name: "z^2 + (-0.4+0.6i)",
        re: -0.4,
        im: 0.6,
        fz: "z2" 
      } , {
        name: "z^2 + 0.279",
        re: 0.279,
        im: 0,
        fz: "z2" 
      } , {
        name: "z^3 + 0.4",
        re: 0.4,
        im: 0,
        fz: "z3" 
      } 
    ];
    
    findPresetByName = function(presetsArray, name) {
        for(var i = 0; i < presetsArray.length; i++) {
            if(presetsArray[i].name === name) {
                return presetsArray[i];
            }
        }
        // Not found
        return null;
    };
    var buttonsDiv = document.getElementById("presetButtons");    
    presets.forEach(function(item){
        var  button = document.createElement("button");
        button.innerHTML = item.name;
        // This will cause a re-flow of the page but we don't care
        buttonsDiv.appendChild(button);    
    });
    
    presetClicked = function(event) {
        event = event || window.event;
        var target = event.target || event.srcElement;
        if(target.nodeName === "BUTTON") {
            var preset = findPresetByName(presets, target.innerHTML);
            if(preset) {
                document.getElementById("re").value = preset.re;
                document.getElementById("im").value = preset.im;
                fz = preset.fz;
                resetZoom();
                drawJulia();
            }
        }
    };
    buttonsDiv.addEventListener("click", presetClicked, false);
 
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var width = canvas.width;
    var height = canvas.height;

    var id = ctx.createImageData(width, height);
    var d  = id.data;
    
    putPixel = function (x, y, r, g, b, a) {
        var index = (x + y * width) * 4;
        d[index+0] = r;
        d[index+1] = g;
        d[index+2] = b;
        d[index+3] = a;
    }
    
    function zoom(event) {
       var xPos = event.x;
        var yPos = event.y;

        xPos -= canvas.offsetLeft;
        yPos -= canvas.offsetTop;

        var xSize = (xmax-xmin) * 0.7;
        var ySize = (ymax-ymin) * 0.7;
        
        xmin = (xmin + xPos * xDelta) - xSize / 2;  
        xmax = (xmin + xPos * xDelta) + xSize / 2;
        ymin = (ymin + yPos * yDelta) - ySize / 2;
        ymax = (ymin + yPos * yDelta) + ySize / 2;
        
        drawJulia();
     }
    
    canvas.addEventListener("mousedown", zoom, false);
 
    resetZoom = function () {    
        xmin = -1.5;
        ymin = -1.15;
        xmax = 1.5;
        ymax = 1.15;
    }
 

   var xmin;
    var ymin;
    var xmax;
    var ymax;
    var xDelta;
    var yDelta;
    var fz = "z2";
    drawJulia = function() {
        xDelta = (xmax-xmin) / width;
        yDelta = (ymax-ymin) / height;
 
        var x;
        var y;
        var iteration;
        var max_iteration = 256;
        var x0 = Number(document.getElementById("re").value);
        var y0 = Number(document.getElementById("im").value);
        for (var Px = 0; Px < width; Px++) {
            for (var Py = 0; Py < height; Py++) {
                x = xmin + Px * xDelta;
                y = ymin + Py * yDelta;

                iteration = 0;
                while ( x*x + y*y < 4 && iteration < max_iteration ) {
                    // Multiplication of complex numbers:
                    // (a+bi) (c+di) = (ac-bd) + (bc+ad)i
                    // c^2 = (x+yi) (x+yi) = (xx-yy) + (yx+yx)i = (xx-yy) + (2xy)i
                    // c^3 = (x+yi) ((xx-yy) + (2xy)i) = (x(xx-yy)-y2xy) +(y(xx-yy)+x2xy)i
                    if(fz === "z2") {
                        xtemp = x*x - y*y + x0;
                        y = 2*x*y + y0;
                    } else if(fz === "z3") {
                        xtemp = x*(x*x-y*y)-y*2*x*y + x0;
                        y = y*(x*x-y*y)+x*2*x*y + y0;
                    } 
                    x = xtemp;
                    iteration = iteration + 1;
                }
                putPixel(Px, Py, 256-iteration, 256-iteration, 256-iteration, 255);
            }
        }
        ctx.putImageData(id, 0, 0);
        console.log("xmin: " + xmin + " xmax: " + xmax + " ymin: " + ymin + " ymax: " + ymax);
    }
    document.getElementById("redrawButton").addEventListener("click", drawJulia, false);
    resetZoom();
    drawJulia();
})();
</script>
</html>
